<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æœ€ç»ˆè¯Šæ–­ï¼šä¸ºä»€ä¹ˆMarkdownæ¸²æŸ“å¤±è´¥</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007cba; }
        .success { border-left-color: green; background: #f0fff0; }
        .error { border-left-color: red; background: #fff0f0; }
        .warning { border-left-color: orange; background: #fff8e7; }
        button { padding: 8px 16px; margin: 5px; background: #007cba; color: white; border: none; cursor: pointer; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; border: 1px solid #ddd; font-size: 12px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ğŸ” æœ€ç»ˆè¯Šæ–­ï¼šMarkdownæ¸²æŸ“å¤±è´¥çš„çœŸæ­£åŸå› </h1>
    
    <div class="comparison">
        <div>
            <h2>âŒ å¤±è´¥çš„å†…å®¹ï¼ˆç”¨æˆ·æä¾›ï¼‰</h2>
            <pre id="failing-content">åŠ è½½ä¸­...</pre>
        </div>
        <div>
            <h2>âœ… ä¿®å¤åçš„å†…å®¹</h2>
            <pre id="fixed-content">åŠ è½½ä¸­...</pre>
        </div>
    </div>
    
    <button onclick="diagnoseIssue()">å¼€å§‹è¯Šæ–­</button>
    <button onclick="testFix()">æµ‹è¯•ä¿®å¤</button>
    
    <div id="diagnosis-result" class="result"></div>
    
    <h2>æ¸²æŸ“å¯¹æ¯”</h2>
    <div class="comparison">
        <div>
            <h3>åŸå§‹å†…å®¹æ¸²æŸ“ç»“æœ</h3>
            <div id="original-render" style="border: 1px solid #ccc; padding: 10px; min-height: 100px;"></div>
        </div>
        <div>
            <h3>ä¿®å¤åæ¸²æŸ“ç»“æœ</h3>
            <div id="fixed-render" style="border: 1px solid #ccc; padding: 10px; min-height: 100px;"></div>
        </div>
    </div>
    
    <div id="final-conclusion" class="result"></div>
    
    <script src="lib/markdown-it.min.js"></script>
    
    <script>
        // ç”¨æˆ·çš„å¤±è´¥å†…å®¹
        const failingContent = `### âš™ï¸ **ä¸€ã€è¡Œä¸šé£é™©ç‰¹æ€§ä¸ä¿é™©éœ€æ±‚**

| **è¡Œä¸š** | **æ ¸å¿ƒé£é™©åœºæ™¯** | **ç½‘å®‰é™©ä¿éšœé‡ç‚¹** | **æ”¿ç­–ä¾æ®** |

|----------|------------------|-------------------|-------------|

| **åŒ–å·¥è¡Œä¸š** | å·¥æ§ç³»ç»Ÿï¼ˆDCS/SISï¼‰é­å‹’ç´¢æ”»å‡»å¯¼è‡´ç”Ÿäº§ä¸­æ–­ | è¦†ç›–åœäº§æŸå¤±ï¼ˆæ—¥å‡äº§å€¼Ã—åœæœºå¤©æ•°ï¼‰ | ã€Šå·¥ä¸šæ§åˆ¶ç³»ç»Ÿä¿¡æ¯å®‰å…¨é˜²æŠ¤æŒ‡å—ã€‹ |

| **ç”µåŠ›è¡Œä¸š** | ç”µç½‘ç›‘æ§ç³»ç»Ÿè¢«å…¥ä¾µå¼•å‘å¤§é¢ç§¯åœç”µ | èµ”å¿ç”µç½‘ç˜«ç—ªç½šæ¬¾ï¼ˆå•æ¬¡æœ€é«˜500ä¸‡ï¼‰ | ã€Šç”µåŠ›å¯é æ€§ç®¡ç†åŠæ³•ã€‹ |

è¿™æ˜¯ä¿é™©+ç§‘æŠ€+æœåŠ¡çš„æ¨¡å¼ã€‚`;

        // æ˜¾ç¤ºå†…å®¹
        document.getElementById('failing-content').textContent = failingContent;
        
        function diagnoseIssue() {
            const result = document.getElementById('diagnosis-result');
            
            // åˆ†æå†…å®¹ç‰¹å¾
            const lines = failingContent.split('\\n');
            const tableLines = lines.filter(line => line.includes('|'));
            const emptyLines = lines.filter(line => line.trim() === '');
            const hasTableGaps = /\\|\\n\\s*\\n\\|/.test(failingContent);
            
            let diagnosis = '<h3>ğŸ” é—®é¢˜è¯Šæ–­ç»“æœ</h3>';
            diagnosis += `<div><strong>æ€»è¡Œæ•°:</strong> ${lines.length}</div>`;
            diagnosis += `<div><strong>è¡¨æ ¼è¡Œæ•°:</strong> ${tableLines.length}</div>`;
            diagnosis += `<div><strong>ç©ºè¡Œæ•°:</strong> ${emptyLines.length}</div>`;
            diagnosis += `<div><strong>è¡¨æ ¼è¡Œé—´æœ‰ç©ºè¡Œ:</strong> ${hasTableGaps ? 'âŒ æ˜¯' : 'âœ… å¦'}</div>`;
            
            // æ£€æŸ¥åˆ†éš”ç¬¦è¡Œ
            const separatorLine = tableLines.find(line => /^\\s*\\|[\\s\\-:]*\\|\\s*$/.test(line));
            diagnosis += `<div><strong>æœ‰åˆ†éš”ç¬¦è¡Œ:</strong> ${separatorLine ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>`;
            
            if (separatorLine) {
                diagnosis += `<div><strong>åˆ†éš”ç¬¦å†…å®¹:</strong> <code>${separatorLine}</code></div>`;
            }
            
            // å…³é”®é—®é¢˜è¯†åˆ«
            diagnosis += '<br><h4>ğŸ¯ å…³é”®é—®é¢˜:</h4>';
            if (hasTableGaps) {
                diagnosis += '<div class="error">âŒ <strong>ä¸»è¦é—®é¢˜:</strong> è¡¨æ ¼è¡Œä¹‹é—´çš„ç©ºè¡Œç ´åäº†Markdownè¡¨æ ¼çš„è¿ç»­æ€§</div>';
                diagnosis += '<div>ğŸ“‹ Markdownè¡¨æ ¼è¦æ±‚æ‰€æœ‰è¡¨æ ¼è¡Œå¿…é¡»è¿ç»­ï¼Œä¸èƒ½æœ‰ç©ºè¡Œåˆ†éš”</div>';
            }
            if (!separatorLine) {
                diagnosis += '<div class="error">âŒ <strong>æ¬¡è¦é—®é¢˜:</strong> å¯èƒ½ç¼ºå°‘æœ‰æ•ˆçš„åˆ†éš”ç¬¦è¡Œ</div>';
            }
            
            result.innerHTML = diagnosis;
            result.className = hasTableGaps ? 'result error' : 'result warning';
        }
        
        function testFix() {
            if (typeof markdownit === 'undefined') {
                document.getElementById('fixed-render').innerHTML = '<p style="color: red;">markdown-it æœªåŠ è½½</p>';
                return;
            }
            
            const md = markdownit({
                html: false,
                breaks: false,
                linkify: true,
                typographer: true
            });
            
            // æµ‹è¯•åŸå§‹å†…å®¹
            console.log('æµ‹è¯•åŸå§‹å†…å®¹æ¸²æŸ“...');
            const originalHtml = md.render(failingContent);
            const originalHasTable = /<table/.test(originalHtml);
            
            document.getElementById('original-render').innerHTML = originalHtml;
            
            // ä¿®å¤å†…å®¹ï¼ˆç§»é™¤è¡¨æ ¼è¡Œé—´ç©ºè¡Œï¼‰
            const fixedContent = failingContent.replace(/(\\|.*\\|)\\n\\s*\\n(?=\\|)/g, '$1\\n');
            document.getElementById('fixed-content').textContent = fixedContent;
            
            console.log('æµ‹è¯•ä¿®å¤åå†…å®¹æ¸²æŸ“...');
            const fixedHtml = md.render(fixedContent);
            const fixedHasTable = /<table/.test(fixedHtml);
            
            document.getElementById('fixed-render').innerHTML = fixedHtml;
            
            // æ˜¾ç¤ºæœ€ç»ˆç»“è®º
            const conclusion = document.getElementById('final-conclusion');
            let conclusionText = '<h3>ğŸ¯ æœ€ç»ˆç»“è®º</h3>';
            
            conclusionText += `<div><strong>åŸå§‹å†…å®¹ç”Ÿæˆè¡¨æ ¼:</strong> ${originalHasTable ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>`;
            conclusionText += `<div><strong>ä¿®å¤åç”Ÿæˆè¡¨æ ¼:</strong> ${fixedHasTable ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>`;
            
            if (!originalHasTable && fixedHasTable) {
                conclusionText += '<div class="success"><h4>ğŸ‰ é—®é¢˜ç¡®è®¤è§£å†³ï¼</h4>';
                conclusionText += '<div><strong>æ ¹æœ¬åŸå› :</strong> è¡¨æ ¼è¡Œä¹‹é—´çš„ç©ºè¡Œå¯¼è‡´markdown-itæ— æ³•è¯†åˆ«å®Œæ•´çš„è¡¨æ ¼ç»“æ„</div>';
                conclusionText += '<div><strong>è§£å†³æ–¹æ¡ˆ:</strong> ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>/(\\\\|.*\\\\|)\\\\n\\\\s*\\\\n(?=\\\\|)/g</code> ç§»é™¤è¡¨æ ¼è¡Œé—´çš„ç©ºè¡Œ</div>';
                conclusionText += '<div><strong>åº”ç”¨ä½ç½®:</strong> åœ¨content.jsçš„ <code>cleanTextContent()</code> å‡½æ•°ä¸­å·²ç»é›†æˆæ­¤ä¿®å¤</div>';
                conclusionText += '</div>';
                conclusion.className = 'result success';
            } else if (!originalHasTable && !fixedHasTable) {
                conclusionText += '<div class="error"><h4>âŒ é—®é¢˜ä»æœªè§£å†³</h4>';
                conclusionText += '<div>å¯èƒ½éœ€è¦æ›´æ·±å…¥çš„ä¿®å¤ï¼Œæˆ–è€…å­˜åœ¨å…¶ä»–æ ¼å¼é—®é¢˜</div>';
                conclusionText += '</div>';
                conclusion.className = 'result error';
            } else if (originalHasTable) {
                conclusionText += '<div class="warning"><h4>âš ï¸ åŸå§‹å†…å®¹å·²ç»å¯ä»¥æ¸²æŸ“</h4>';
                conclusionText += '<div>è¿™è¡¨æ˜é—®é¢˜å¯èƒ½åœ¨ç‰¹å®šç¯å¢ƒæˆ–æ›´å¤æ‚çš„å†…å®¹ä¸­</div>';
                conclusionText += '</div>';
                conclusion.className = 'result warning';
            }
            
            conclusionText += '<br><h4>ğŸ“‹ è¡ŒåŠ¨å»ºè®®:</h4>';
            conclusionText += '<div>1. âœ… ç¡®ä¿æ’ä»¶ä¸­çš„ <code>cleanTextContent()</code> å‡½æ•°æ­£å¸¸å·¥ä½œ</div>';
            conclusionText += '<div>2. âœ… éªŒè¯å¢å¼ºæå–ç­–ç•¥æ˜¯å¦è¢«æ­£ç¡®åº”ç”¨</div>';
            conclusionText += '<div>3. âœ… åœ¨è…¾è®¯æ–‡æ¡£ä¸­å®é™…æµ‹è¯•ä¿®å¤æ•ˆæœ</div>';
            conclusionText += '<div>4. âœ… æ£€æŸ¥ä¾§è¾¹æ çš„markdown-ité…ç½®æ˜¯å¦æ­£ç¡®</div>';
            
            conclusion.innerHTML = conclusionText;
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œè¯Šæ–­
        window.addEventListener('load', function() {
            setTimeout(() => {
                diagnoseIssue();
                setTimeout(() => {
                    testFix();
                }, 1000);
            }, 500);
        });
    </script>
</body>
</html>