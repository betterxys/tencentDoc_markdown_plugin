<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本展示优化测试</title>
    <link rel="stylesheet" href="sidepanel.css">
    <style>
        body {
            margin: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .test-container {
            max-width: 400px;
            height: 600px;
            border: 2px solid #ccc;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }
        .test-title {
            background: #f0f0f0;
            padding: 10px;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
        }
        .toggle-a11y {
            margin: 10px 0;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>文本展示优化测试</h1>
    
    <button class="toggle-a11y" onclick="toggleAccessibility()">
        切换无障碍模式
    </button>
    
    <div style="display: flex; gap: 20px;">
        <!-- 短文本测试 -->
        <div class="test-container">
            <div class="test-title">短文本 (无头部)</div>
            <div class="markdown-body" id="short-text-container">
                <!-- 短文本内容将在这里渲染 -->
            </div>
        </div>
        
        <!-- 长文本测试 -->
        <div class="test-container">
            <div class="test-title">长文本 (有头部)</div>
            <div class="markdown-body" id="long-text-container">
                <!-- 长文本内容将在这里渲染 -->
            </div>
        </div>
    </div>
    
    <script>
        // 模拟 escapeHtml 函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 模拟 renderTextContent 函数
        function renderTextContent(content, contentType) {
            const escapedContent = escapeHtml(content);
            
            // 计算内容统计信息
            const lineCount = content.split('\n').length;
            const charCount = content.length;
            const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
            const isLongText = content.length > 300;
            
            // 统一使用改进后的样式
            const className = 'text-content';
            
            // 为长文本添加内容信息头部
            const headerHtml = isLongText ? `
                <div class="text-header">
                    <div class="text-title">文本内容</div>
                    <div class="text-meta">
                        ${lineCount} 行 · ${charCount} 字符 · ${wordCount} 词
                    </div>
                </div>
            ` : '';
            
            return `
                <div class="content-type-${contentType}">
                    ${headerHtml}
                    <div class="${className}">${escapedContent}</div>
                </div>
            `;
        }
        
        // 测试数据
        const shortText = `这是一段短文本内容。
可以测试基本的文本展示效果。`;
        
        const longText = `这是一段很长的文本内容，用来测试长文本的展示效果和用户体验优化。

在优化之前，文本内容有以下问题：
1. 固定的高度限制（300px或400px）
2. 在小容器内滚动，体验不佳
3. 使用等宽字体，不适合长段落阅读
4. 缺乏内容预览和统计信息

优化后的改进：
1. 移除高度限制，采用Markdown相同的自适应方式
2. 使用系统字体而非等宽字体，提高可读性
3. 增加内容统计信息（行数、字符数、词数）
4. 改进边框、背景色、间距等视觉样式
5. 保持与Markdown一致的用户体验

现在长文本可以完整展示，不再受到高度限制的约束。用户可以自然地滚动浏览全部内容，就像阅读Markdown文档一样。

这段文本足够长，可以测试：
- 文本头部的显示效果
- 统计信息的准确性
- 无障碍模式的增强效果
- 整体的视觉层次和排版

测试内容包含多个段落，可以验证 white-space: pre-wrap 和 word-wrap: break-word 的效果，确保长行能够正确换行，同时保持原有的换行结构。

最终的目标是让文本展示达到与Markdown相同的用户体验水平。`;
        
        // 渲染测试内容
        function renderTests() {
            document.getElementById('short-text-container').innerHTML = 
                renderTextContent(shortText, 'text');
            document.getElementById('long-text-container').innerHTML = 
                renderTextContent(longText, 'text');
        }
        
        // 切换无障碍模式
        function toggleAccessibility() {
            document.body.classList.toggle('accessibility-mode');
        }
        
        // 页面加载完成后渲染测试内容
        document.addEventListener('DOMContentLoaded', renderTests);
    </script>
</body>
</html>