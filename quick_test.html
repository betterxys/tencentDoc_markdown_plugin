<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¿«é€ŸåŠŸèƒ½éªŒè¯</title>
    <script src="lib/markdown-it.min.js"></script>
    <script src="lib/purify.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å¿«é€ŸåŠŸèƒ½éªŒè¯</h1>
    
    <div class="test">
        <h2>1. markdown-it åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <div id="test1-result"></div>
    </div>
    
    <div class="test">
        <h2>2. å¤±è´¥å†…å®¹æµ‹è¯•ï¼ˆå¸¦ç©ºè¡Œè¡¨æ ¼ï¼‰</h2>
        <div id="test2-result"></div>
    </div>
    
    <div class="test">
        <h2>3. DOMPurify å®‰å…¨æµ‹è¯•</h2>
        <div id="test3-result"></div>
    </div>
    
    <script>
        function runTests() {
            console.log('ğŸš€ å¼€å§‹å¿«é€ŸåŠŸèƒ½éªŒè¯');
            
            // æµ‹è¯•1: markdown-itåŸºç¡€åŠŸèƒ½
            try {
                const md = markdownit({
                    html: false,
                    linkify: true,
                    typographer: true
                });
                
                const basicMarkdown = '# æ ‡é¢˜\n\n**ç²—ä½“** å’Œ *æ–œä½“*\n\n- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2';
                const basicResult = md.render(basicMarkdown);
                
                document.getElementById('test1-result').innerHTML = `
                    <div class="success">âœ… markdown-it åŸºç¡€åŠŸèƒ½æ­£å¸¸</div>
                    <div class="result">${basicResult}</div>
                `;
                
            } catch (error) {
                document.getElementById('test1-result').innerHTML = `
                    <div class="error">âŒ markdown-it åŸºç¡€åŠŸèƒ½å¤±è´¥: ${error.message}</div>
                `;
            }
            
            // æµ‹è¯•2: å¤±è´¥å†…å®¹ï¼ˆå¸¦ç©ºè¡Œè¡¨æ ¼ï¼‰
            try {
                const md = markdownit();
                const failingContent = `### æµ‹è¯•è¡¨æ ¼

| **è¡Œä¸š** | **åœºæ™¯** |

|----------|----------|

| **åŒ–å·¥** | æ”»å‡»åœºæ™¯ |`;
                
                const tableResult = md.render(failingContent);
                const hasTable = /<table/.test(tableResult);
                
                document.getElementById('test2-result').innerHTML = `
                    <div class="${hasTable ? 'success' : 'error'}">
                        ${hasTable ? 'âœ…' : 'âŒ'} è¡¨æ ¼æ¸²æŸ“: ${hasTable ? 'æˆåŠŸ' : 'å¤±è´¥'}
                    </div>
                    <div class="result">${tableResult}</div>
                `;
                
            } catch (error) {
                document.getElementById('test2-result').innerHTML = `
                    <div class="error">âŒ è¡¨æ ¼æµ‹è¯•å¤±è´¥: ${error.message}</div>
                `;
            }
            
            // æµ‹è¯•3: DOMPurifyå®‰å…¨æµ‹è¯•
            try {
                const dirtyHtml = '<script>alert("XSS")</script><p>å®‰å…¨å†…å®¹</p><table><tr><td>è¡¨æ ¼å†…å®¹</td></tr></table>';
                const cleanHtml = DOMPurify.sanitize(dirtyHtml, {
                    ALLOWED_TAGS: ['p', 'table', 'tr', 'td', 'th'],
                    ALLOWED_ATTR: []
                });
                
                const hasScript = /<script/.test(cleanHtml);
                const hasTable = /<table/.test(cleanHtml);
                
                document.getElementById('test3-result').innerHTML = `
                    <div class="${!hasScript ? 'success' : 'error'}">
                        ${!hasScript ? 'âœ…' : 'âŒ'} XSSé˜²æŠ¤: ${!hasScript ? 'æ­£å¸¸' : 'å¤±è´¥'}
                    </div>
                    <div class="${hasTable ? 'success' : 'error'}">
                        ${hasTable ? 'âœ…' : 'âŒ'} è¡¨æ ¼ä¿ç•™: ${hasTable ? 'æ­£å¸¸' : 'å¤±è´¥'}
                    </div>
                    <div class="result">${cleanHtml}</div>
                `;
                
            } catch (error) {
                document.getElementById('test3-result').innerHTML = `
                    <div class="error">âŒ DOMPurifyæµ‹è¯•å¤±è´¥: ${error.message}</div>
                `;
            }
            
            console.log('âœ… å¿«é€ŸåŠŸèƒ½éªŒè¯å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = runTests;
    </script>
</body>
</html>